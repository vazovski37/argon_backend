version: '3.8'

services:
  backend:
    environment:
      - FLASK_ENV=production
      - GCS_BUCKET=${GCS_BUCKET}
      - GCS_PROJECT_ID=${GCS_PROJECT_ID}
      - GCP_PROJECT_ID=${GCP_PROJECT_ID}
      - VERTEX_RAG_CORPUS_NAME=${VERTEX_RAG_CORPUS_NAME}
      # Override local MinIO settings to empty or remove them
      - S3_ENDPOINT=
      - S3_ACCESS_KEY=
      - S3_SECRET_KEY=
      - S3_BUCKET=
    # Remove volume mount for local code development
    volumes:
      - ./uploads:/app/uploads
    # In production, we don t need MinIO dependency
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_started

  # Disable MinIO in production
  minio:
    profiles: ["donotstart"]
